
import React, { createContext, useState, useContext, useEffect, useCallback } from 'react';
import { Language } from './types';

const translations = {
  ar: {
    discoverPleasureOfLearning: "اكتشف متعة التعلم",
    back: "رجوع",
    logout: "خروج",
    comingSoonTitle: "قريبا...",
    comingSoonMessage: "هذه الميزة قيد التطوير حاليًا. ترقبوا التحديثات!",
    notifications: "الإشعارات",
    noNewNotifications: "لا توجد إشعارات جديدة.",
    notificationMessage: "تمت إضافة ملاحظة جديدة من الأستاذ في مادة {subject}.",
    notificationNewSummary: "تمت إضافة ملخص جديد في مادة {subject}.",
    notificationNewExercise: "تمت إضافة تمارين جديدة في مادة {subject}.",
    notificationNewExamProgram: "تمت إضافة برنامج فروض جديد في مادة {subject}.",
    unifiedLoginWelcome: "مرحبا بك في تطبيق امتياز",
    unifiedLoginPrompt: "الرجاء إدخال رمز الدخول الخاص بك",
    loginCodePlaceholder: "رمز الدخول",
    login: "الدخول",
    requestHelp: "طلب مساعدة",
    helpNote: "ملاحظة: عند الضغط على طلب مساعدة ستتحول تلقائيا إلى الإتصال برقم هاتفي.",
    invalidCode: "الرمز المدخل غير صحيح. الرجاء المحاولة مرة أخرى أو طلب المساعدة.",
    superAdminDashboardTitle: "لوحة تحكم المدير الخارق",
    addSchoolSectionTitle: "إضافة مدرسة جديدة",
    newSchoolNamePlaceholder: "اسم المدرسة الجديدة",
    principalSecretCodePlaceholder: "الرمز السري الخاص بالمدير",
    addSchool: "إضافة المدرسة",
    enterSchoolNameAndCode: "الرجاء إدخال اسم المدرسة ورمز المدير.",
    currentSchools: "المدارس الحالية",
    principalCodeLabel: "رمز المدير",
    delete: "حذف",
    confirmDeleteSchool: "هل أنت متأكد من رغبتك في حذف مدرسة \"{schoolName}\"؟ سيتم حذف جميع بياناتها بشكل دائم.",
    noSchoolsAdded: "لا توجد مدارس مضافة بعد.",
    principalDashboardTitle: "لوحة تحكم المدير(ة)",
    principalWelcome: "أهلاً بك. اختر الإجراء المطلوب.",
    manageTeachers: "إدارة الأساتذة",
    manageStudents: "إدارة التلاميذ",
    announcements: "الإعلانات",
    exercises: "تمارين أسبوعية",
    summaries: "الملخصات",
    complaintsAndSuggestions: "عرض الاقتراحات والشكاوى",
    educationalTips: "نصائح تربوية",
    performanceTracking: "تتبع أداء التلاميذ",
    reviewNotes: "مراجعة الملاحظات",
    guardianDashboardTitle: "لوحة تحكم ولي الأمر",
    studentLevel: "المستوى",
    selectSubjectToFollow: "اختر المادة للمتابعة",
    viewAnnouncements: "عرض الإعلانات",
    viewEducationalTips: "عرض النصائح التربوية",
    submitComplaintOrSuggestion: "تقديم شكوى أو اقتراح",
    teacherDashboardTitle: "لوحة تحكم الأستاذ(ة)",
    teacherSelectLevelAndSubject: "الرجاء تحديد المستوى والمادة",
    level: "المستوى",
    subject: "المادة",
    next: "التالي",
    add: 'إضافة',
    teacherName: 'اسم الأستاذ(ة)',
    loginCode: 'رمز الدخول',
    levels: 'المستويات',
    classes: 'الأفواج',
    addTeacher: 'إضافة أستاذ',
    existingTeachers: 'الأساتذة الحاليون',
    confirmDeleteTeacher: 'هل أنت متأكد من حذف الأستاذ {name}؟',
    noTeachers: 'لا يوجد أساتذة حاليا.',
    edit: 'تعديل',
    updateTeacher: 'تحديث البيانات',
    announcementContent: 'محتوى الإعلان',
    attachFile: 'إرفاق ملف (صورة أو PDF)',
    targetAudience: 'إرسال إلى',
    guardians: 'أولياء الأمور',
    teachers: 'الأساتذة',
    sendAnnouncement: 'إرسال الإعلان',
    sentAnnouncements: 'الإعلانات المرسلة',
    complaintContent: 'محتوى الشكوى / الاقتراح',
    submit: 'إرسال',
    receivedComplaints: 'الشكاوى والاقتراحات المستلمة',
    fromGuardianOf: 'من ولي أمر التلميذ(ة)',
    educationalTipContent: 'محتوى النصيحة',
    generateWithAI: 'توليد نصيحة بالذكاء الاصطناعي',
    sendTip: 'إرسال النصيحة',
    sentTips: 'النصائح المرسلة',
    performanceOverview: 'نظرة عامة على الأداء',
    averageGradePerLevel: 'متوسط المعدلات حسب المستوى',
    levelPerformance: 'أداء المستوى: {level}',
    studentName: 'اسم التلميذ',
    averageGrade: 'المعدل العام',
    performanceTrend: 'منحنى التطور',
    noComplaints: 'لا توجد شكاوى أو اقتراحات حاليا.',
    noAnnouncements: 'لا توجد إعلانات حاليا.',
    noTips: 'لا توجد نصائح حاليا.',
    confirm: 'تأكيد',
    cancel: 'إلغاء',
    fillAllFields: 'الرجاء ملء جميع الحقول.',
    guardianNotesTitle: 'الملاحظات والغيابات',
    addStudent: 'إضافة تلميذ',
    guardianCode: 'رمز ولي الأمر',
    existingStudents: 'التلاميذ الحاليون',
    confirmDeleteStudent: 'هل أنت متأكد من حذف التلميذ {name}؟',
    noStudents: 'لا يوجد تلاميذ حاليا.',
    class: 'القسم',
    statisticsDashboard: 'لوحة الإحصائيات',
    interviewRequests: 'طلبات المقابلة',
    monthlyFees: 'الواجبات الشهرية',
    schoolManagement: 'إدارة المدرسة',
    importFromExcel: 'استيراد التلاميذ من ملف اكسل',
    importInstructions: "يجب أن يحتوي الملف على عمودين: العمود الأول لأسماء التلاميذ، والعمود الثاني للرمز السري الخاص بأوليائهم.",
    selectFile: 'اختر ملف إكسل',
    import: 'استيراد',
    importSuccess: 'تم استيراد {count} تلميذ بنجاح.',
    importError: 'حدث خطأ أثناء الاستيراد. يرجى التحقق من تنسيق الملف.',
    selectLevelAndClass: 'الرجاء اختيار المستوى والقسم أولاً.',
    manageSchool: 'إدارة المدرسة',
    schoolStatus: 'حالة المدرسة',
    active: 'نشطة',
    inactive: 'متوقفة',
    maintenanceTitle: 'التطبيق في وضع الصيانة',
    maintenanceMessage: 'التطبيق يخضع حالياً للصيانة. الرجاء المحاولة مرة أخرى لاحقاً.',
    statisticsDashboard_feature: "خاصية: لوحة الإحصائيات",
    educationalTips_feature: "خاصية: نصائح تربوية",
    announcements_feature: "خاصية: الإعلانات",
    complaintsAndSuggestions_feature: "خاصية: الشكاوى والاقتراحات",
    reviewNotes_feature: "خاصية: مراجعة الملاحظات",
    monthlyFees_feature: "خاصية: الرسوم الشهرية",
    interviewRequests_feature: "خاصية: طلبات المقابلة",
    schoolManagement_feature: "خاصية: إدارة المدرسة",
    manage: "إدارة",
    featureToggleTitle: "تفعيل / تعطيل الميزات",
    browseAsTeacher: "التصفح كأستاذ",
    browseAsTeacher_feature: "خاصية: التصفح كأستاذ",
    selectLevelAndSubjectPrompt: "الرجاء اختيار المستوى، المادة والقسم",
    selectClassPrompt: "الرجاء اختيار القسم",
    sendForReview: "إرسال للمراجعة",
    sentForReviewSuccess: "تم إرسال الملاحظة للمراجعة بنجاح!",
    aiGeneratedNote: "✨ ملاحظة من الذكاء الاصطناعي",
    feeNotification: "قام التلميذ(ة) {studentName} بأداء الواجب الشهري بقيمة {amount} درهم.",
    payNow: "أداء الواجب الآن",
    paymentAmount: "المبلغ المدفوع (درهم)",
    paymentHistory: "سجل الأداء",
    paidOn: "تم الأداء بتاريخ",
    paymentSuccessful: "تم الأداء بنجاح!",
    requestInterview: "طلب مقابلة",
    confirmRequestInterview: "تأكيد طلب المقابلة",
    requestSent: "تم إرسال طلبك بنجاح.",
    paymentStatus: "حالة الأداء",
    paid: "أدى الواجب",
    notPaid: "لم يؤد الواجب",
    markAsPaid: "تغيير إلى 'أدى'",
    principalFeeManagement: "حالة أداء التلاميذ للواجب الشهري",
    noInterviewRequests: "لا توجد طلبات مقابلة حاليا.",
    requestFrom: "طلب من ولي أمر التلميذ(ة) {studentName}",
    markAsCompleted: "تمت المقابلة",
    monthlyFeePrompt: "هنا يمكنك تتبع وأداء الواجبات الشهرية للسنة الدراسية.",
    noPayments: "لا يوجد سجل أداء.",
    requestInterviewPrompt: "هل تود تأكيد طلب مقابلة مع الإدارة؟",
    payByCard: "الأداء عبر البطاقة البنكية",
    cardDetails: "معلومات البطاقة",
    cardNumber: "رقم البطاقة",
    expiryDate: "تاريخ انتهاء الصلاحية (MM/YY)",
    cvc: "رمز التحقق (CVC)",
    cardholderName: "اسم حامل البطاقة",
    confirmPayment: "تأكيد الدفع",
    processingPayment: "جاري معالجة الدفع...",
    academicYearMonths: "شهور السنة الدراسية",
    paymentDue: "واجب الأداء",
    paymentCompleted: "تم الأداء",
    pay: "أداء",
    setMonthlyFee: 'تحديد الواجب الشهري',
    monthlyFeeAmountLabel: 'قيمة الواجب الشهري (درهم)',
    transportation: 'النقل',
    monthlyFee: 'الواجب الشهري',
    totalAmount: 'المبلغ الإجمالي',
    setTransportationFee: 'تحديد رسوم النقل',
    transportationFeeAmountLabel: 'قيمة رسوم النقل (درهم)',
    
    // Features from user prompt
    supplementaryLessons: 'الدروس الداعمة والتفاعلية',
    addSupplementaryLesson: 'إضافة درس داعم',
    lessonTitle: 'عنوان الدرس/الرابط',
    externalLink: 'الرابط الخارجي (يوتيوب، موقع تعليمي... إلخ)',
    addLink: 'إضافة الرابط',
    noLessons: 'لا توجد دروس داعمة حاليا.',
    
    timetable: 'جدول التوقيت',
    addTimetable: 'إضافة جدول توقيت',
    uploadTimetable: 'تحميل جدول التوقيت (صورة أو PDF)',
    noTimetable: 'لا يوجد جدول توقيت حالي.',

    quizzes: 'اختبارات قصيرة',
    addQuiz: 'إضافة اختبار قصير',
    generateQuizFromImage: 'إنشاء اختبار من صورة',
    uploadImageForQuiz: 'ارفع صورة لملخص أو تمارين لإنشاء اختبار',
    generatingQuiz: 'جاري إنشاء الاختبار بالذكاء الاصطناعي...',
    quizGenerated: 'تم إنشاء الاختبار بنجاح! الرجاء مراجعته قبل الحفظ.',
    saveQuiz: 'حفظ الاختبار',
    noQuizzes: 'لا توجد اختبارات قصيرة حاليا.',

    unitProject: 'مشروع الوحدة',
    addProject: 'إضافة مشروع',
    projectTitle: 'عنوان المشروع',
    projectDescription: 'وصف المشروع',
    takePhoto: 'التقاط صورة',
    uploadPhoto: 'رفع صورة',
    noProjects: 'لا توجد مشاريع حاليا.',
    capture: 'التقاط',

    digitalLibrary: 'مكتبة القسم الرقمية',
    addBook: 'إضافة كتاب أو قصة',
    bookTitle: 'عنوان الكتاب',
    bookDescription: 'وصف قصير',
    uploadBook: 'تحميل الكتاب (PDF)',
    download: 'تحميل',
    noBooks: 'المكتبة فارغة حاليا.',
    
    manageFees: 'إدارة الرسوم',
    update: 'تحديث',
    feesUpdated: 'تم تحديث الرسوم بنجاح!',

    // New AI Features & Album
    lessonPlanner: 'مخطط الدروس',
    lessonTopic: 'موضوع الدرس',
    generatePlan: 'إنشاء الخطة',
    generatingPlan: 'جاري إنشاء الخطة...',
    lessonPlan: 'خطة الدرس',
    learningObjectives: 'الأهداف التعليمية',
    inClassActivities: 'أنشطة مقترحة',
    homework: 'واجبات منزلية',
    discussionQuestions: 'أسئلة للمناقشة',

    personalizedExercises: 'تمارين مخصصة',
    generateExercises: 'إنشاء تمارين مخصصة',
    selectStudentForExercises: 'اختر تلميذا لإنشاء تمارين مخصصة له',
    generatingExercises: 'جاري إنشاء التمارين...',
    supportExercises: 'تمارين دعم',
    enrichmentExercises: 'تمارين إثراء',
    saveAndSendExercises: 'حفظ وإرسال التمارين',
    noPersonalizedExercises: 'لا توجد تمارين مخصصة حاليا.',
    notificationNewPersonalizedExercise: 'تمت إضافة تمارين مخصصة جديدة لك في مادة {subject}.',

    insightsDashboard: 'تحليل الشكاوى (BETA)',
    analyzeComplaints: 'تحليل الشكاوى بالذكاء الاصطناعي',
    generatingAnalysis: 'جاري التحليل...',
    complaintAnalysis: 'تحليل الشكاوى',
    commonThemes: 'المواضيع المتكررة',
    sentimentSummary: 'ملخص المشاعر العامة',
    noComplaintsToAnalyze: 'لا توجد شكاوى كافية للتحليل.',

    classAlbum: 'ألبوم الفصل',
    addPhoto: 'إضافة صورة للألبوم',
    photoCaption: 'أضف تعليقاً على الصورة',
    savePhoto: 'حفظ الصورة',
    noPhotos: 'الألبوم فارغ حاليا.',
    notificationNewPhoto: 'تمت إضافة صورة جديدة إلى ألبوم الفصل.',
    reviewAlbumPhotos: 'مراجعة صور الألبوم',
    approve: 'قبول',
    reject: 'رفض',
    pendingReview: 'قيد المراجعة',
    approved: 'موافق عليه',
    photoSentForReview: 'تم إرسال الصورة للمراجعة بنجاح.',
    noPhotosToReview: 'لا توجد صور في انتظار المراجعة.',
    reviewAlbumPhotos_feature: 'خاصية: مراجعة صور الألبوم',
    notificationNewPhotoForReview: 'صورة جديدة من الأستاذ تنتظر المراجعة.',
    unifiedAssessments: 'التقويمات الموحدة',
    addUnifiedAssessment: 'إضافة تقويم موحد',
    assessmentTitle: 'عنوان التقويم',
    noAssessments: 'لا توجد تقويمات موحدة حاليا.',
    notificationNewUnifiedAssessment: 'تمت إضافة تقويم موحد جديد في مادة {subject}.',
    saveSuccess: 'تم الحفظ بنجاح!',
    confirmDeleteAssessment: 'هل أنت متأكد من حذف هذا التقويم؟',
    confirmDeleteQuiz: 'هل أنت متأكد من حذف هذا الاختبار؟',
    confirmDeleteProject: 'هل أنت متأكد من حذف هذا المشروع؟',

    notesAndAbsences: 'الملاحظات والغيابات',
    studentGrades: 'مستوى التلميذ(ة)',
    examProgram: 'برنامج الفروض',
    aiNotes: 'ملاحظات بالذكاء الإصطناعي',
    notes: 'الملاحظات',
    darkMode: "الوضع الليلي",
    
    // Stages and new subjects
    pre_schoolStage: "التعليم الأولي",
    primaryStage: "المرحلة الابتدائية",
    middleStage: "المرحلة الإعدادية",
    highStage: "المرحلة الثانوية",
    selectStage: "اختر المرحلة الدراسية",
    'اللغة الإنجليزية': 'اللغة الإنجليزية',
    'الفيزياء والكيمياء': 'الفيزياء والكيمياء',
    'علوم الحياة والأرض': 'علوم الحياة والأرض',
    'المعلوميات': 'المعلوميات',
    'الفلسفة': 'الفلسفة',
    'التربية الإسلامية': 'التربية الإسلامية',
    'الاجتماعيات': 'الاجتماعيات',
    'اللغة العربية': 'اللغة العربية',
    'اللغة الفرنسية': 'اللغة الفرنسية',
    'الرياضيات': 'الرياضيات',

    // New Feature Flags
    principalFeaturesSection: "ميزات المدير",
    teacherFeaturesSection: "ميزات المعلم",
    guardianFeaturesSection: "ميزات ولي الأمر",
    teacherManageSummaries_feature: 'خاصية: إدارة الملخصات',
    teacherManageExercises_feature: 'خاصية: إدارة التمارين',
    teacherManageNotesAndAbsences_feature: 'خاصية: إدارة الملاحظات والغياب',
    teacherManageGrades_feature: 'خاصية: إدارة النقط',
    teacherManageExamProgram_feature: 'خاصية: إدارة برنامج الفروض',
    teacherGenerateAiNotes_feature: 'خاصية: ملاحظات بالذكاء الاصطناعي',
    teacherLessonPlanner_feature: 'خاصية: مخطط الدروس بالذكاء الاصطناعي',
    teacherPersonalizedExercises_feature: 'خاصية: تمارين مخصصة بالذكاء الاصطناعي',
    teacherManageSupplementaryLessons_feature: 'خاصية: إدارة الدروس الداعمة',
    teacherManageUnifiedAssessments_feature: 'خاصية: إدارة التقويمات الموحدة',
    teacherManageTimetable_feature: 'خاصية: إدارة جداول الحصص',
    teacherManageQuizzes_feature: 'خاصية: إدارة الاختبارات القصيرة',
    teacherManageProjects_feature: 'خاصية: إدارة مشاريع الوحدة',
    teacherManageLibrary_feature: 'خاصية: إدارة المكتبة الرقمية',
    teacherManageAlbum_feature: 'خاصية: إدارة ألبوم الفصل',
    teacherManageTalkingCards_feature: "خاصية: إدارة البطاقات الناطقة",
    teacherManageMemorization_feature: "خاصية: مساعد الحفظ للأستاذ",
    teacherViewAnnouncements_feature: 'خاصية: عرض الإعلانات للأساتذة',
    guardianViewSummaries_feature: 'خاصية: عرض الملخصات',
    guardianViewExercises_feature: 'خاصية: عرض التمارين',
    guardianViewNotesAndAbsences_feature: 'خاصية: عرض الملاحظات والغياب',
    guardianViewGrades_feature: 'خاصية: عرض النقط',
    guardianViewExamProgram_feature: 'خاصية: عرض برنامج الفروض',
    guardianViewPersonalizedExercises_feature: 'خاصية: عرض التمارين المخصصة',
    guardianViewSupplementaryLessons_feature: 'خاصية: عرض الدروس الداعمة',
    guardianViewUnifiedAssessments_feature: 'خاصية: عرض التقويمات الموحدة',
    guardianViewTimetable_feature: 'خاصية: عرض جدول الحصص',
    guardianViewQuizzes_feature: 'خاصية: عرض الاختبارات القصيرة',
    guardianViewProjects_feature: 'خاصية: عرض مشاريع الوحدة',
    guardianViewLibrary_feature: 'خاصية: عرض المكتبة الرقمية',
    guardianViewAlbum_feature: 'خاصية: عرض ألبوم الفصل',
    guardianPayFees_feature: 'خاصية: أداء الواجبات الشهرية',
    guardianSubmitComplaints_feature: 'خاصية: تقديم الشكاوى والاقتراحات',
    guardianRequestInterview_feature: 'خاصية: طلب مقابلة',
    guardianViewTalkingCards_feature: "خاصية: عرض البطاقات الناطقة",
    guardianViewMemorization_feature: "خاصية: مساعد الحفظ للتلميذ",

    // Talking Cards Feature
    talkingCards: "البطاقات الناطقة",
    addTalkingCard: "إضافة بطاقة ناطقة",
    analyzeWithAI: "تحليل الصورة بالذكاء الاصطناعي",
    analyzing: "جاري التحليل...",
    reviewAIDetections: "مراجعة وتعديل النتائج",
    editAIDetections_desc: "يمكنك تعديل النصوص التي استخرجها الذكاء الاصطناعي أو حذفها قبل الحفظ.",
    saveCard: "حفظ البطاقة",
    cardSaved: "تم حفظ البطاقة بنجاح!",
    listen: "استماع",
    noTalkingCards: "لا توجد بطاقات ناطقة حاليا.",
    notificationNewTalkingCard: "تمت إضافة بطاقة ناطقة جديدة.",

    // Memorization Helper
    memorizationHelper: "مساعد الحفظ",
    addMemorizationItem: "إضافة مادة للحفظ",
    memorizationItemTitle: "عنوان المادة (مثال: سورة الفاتحة)",
    addByText: "إضافة نص",
    addByImage: "إضافة صورة",
    addByAudio: "تسجيل صوتي",
    contentText: "المحتوى النصي",
    recordAudio: "بدء التسجيل",
    stopRecording: "إيقاف التسجيل",
    listenToRecording: "الاستماع للتسجيل",
    saveItem: "حفظ المادة",
    itemSaved: "تم حفظ المادة بنجاح!",
    noMemorizationItems: "لا توجد مواد للحفظ حالياً.",
    repeat: "تكرار",
    repeatCount: "عدد مرات التكرار",
    infiniteRepeat: "تكرار مستمر",
    notificationNewMemorizationItem: "تمت إضافة مادة جديدة للحفظ في {subject}.",
    confirmDeleteMemorizationItem: "هل أنت متأكد من حذف هذه المادة؟",
    extractingTextFromImage: "جاري استخراج النص من الصورة...",
    
    // Super Admin Principal Management
    managePrincipals: "إدارة المديرين",
    principalManagementForStage: "إدارة المديرين للمرحلة: {stageName}",
    changePassword: "تغيير كلمة المرور",
    newPassword: "كلمة المرور الجديدة",
    savePassword: "حفظ كلمة المرور",
    principalName: "اسم المدير",
    confirmDeletePrincipal: "هل أنت متأكد من حذف المدير {name}؟",
    
    // Newly added keys
    feedbackThanks: "شكراً جزيلاً لملاحظاتك القيمة!",
    rememberMe: "تذكرني",
    enterAsPrincipal: "الدخول كمدير",
    enterPrincipalDashboard: "لوحة تحكم {stageName}",
    contentDomainOptional: "المجال (اختياري)",
    financialManagement: "الإدارة المالية",
    selectTeachers: 'اختر الأساتذة',
    all: 'الجميع',
    miscellaneous: 'متنوع',
    financialSummary: "ملخص مالي",
    totalIncome: "إجمالي المداخيل",
    totalExpenses: "إجمالي المصاريف",
    netProfit: "الربح الصافي",
    netLoss: "الخسارة الصافية",
    expenses: "المصاريف",
    teacherSalaries: "رواتب الأساتذة",
    manualExpenses: "مصاريف أخرى",
    addExpense: "إضافة مصروف",
    expenseDescription: "وصف المصروف",
    amount: "المبلغ",
    income: "المداخيل",
    feedbackAnalysis: "تحليل الملاحظات",
    noFeedbackToAnalyze: "لا توجد ملاحظات كافية للتحليل.",
    averageRating: "متوسط التقييم",
    analyzeAllFeedback: "تحليل كل الملاحظات",
    allFeedback: "كل الملاحظات",
    rating: "التقييم",
    comments: "التعليقات",
    userRole: "دور المستخدم",
    school: "المدرسة",
    feedbackAnalysisReport: "تقرير تحليل الملاحظات",
    ratingRequired: "الرجاء تحديد تقييمك أولاً.",
    feedbackTitle: "ملاحظاتك تهمنا!",
    feedbackPrompt: "كيف تقيم تجربتك مع التطبيق؟",
    feedbackPlaceholder: "اكتب ملاحظاتك أو اقتراحاتك هنا لتحسين التطبيق...",
    send: "إرسال",
    later: "لاحقاً",
    financialManagement_feature: "خاصية: الإدارة المالية",
    saveChanges: 'حفظ التغييرات',
  },
  fr: {},
  en: {},
};

// Populate fr and en with keys from ar if they are empty
Object.keys(translations.ar).forEach(key => {
    const k = key as keyof typeof translations.ar;
    if (!translations.fr[k]) {
        translations.fr[k] = k;
    }
    if (!translations.en[k]) {
        translations.en[k] = k;
    }
});


type Translations = typeof translations.ar;

const LanguageContext = createContext({
  language: 'ar' as Language,
  setLanguage: (lang: Language) => {},
  t: (key: keyof Translations, replacements?: {[key: string]: string}): string => '',
});

export const LanguageProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [language, setLanguageState] = useState<Language>('ar');

  useEffect(() => {
    document.documentElement.lang = language;
    document.documentElement.dir = language === 'ar' ? 'rtl' : 'ltr';
  }, [language]);
  
  const setLanguage = useCallback((lang: Language) => {
    if (['ar', 'fr', 'en'].includes(lang)) {
        setLanguageState(lang);
    }
  }, []);

  const t = useCallback((key: keyof Translations, replacements?: {[key: string]: string}) => {
    let translation: string = (translations[language] as any)[key] || (translations['ar'] as any)[key];
    if(translation === undefined) return key as string;

    if (replacements) {
        Object.keys(replacements).forEach(rKey => {
            translation = translation.replace(`{${rKey}}`, replacements[rKey]);
        })
    }
    return translation;
  }, [language]);

  return React.createElement(LanguageContext.Provider, { value: { language, setLanguage, t } }, children);
};

export const useTranslation = () => useContext(LanguageContext);
